<!-- 
	Name: Ryan Tick, James Harkins, Kyle Kozak
	Date: 09/14/2015
	Class: Software Engineering
	HW: Horizontal Design
	Main Page
-->

<!DOCTYPE html>

<html>

	<head>
		<title> The Vault </title>
		<link rel="stylesheet" href="forms.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	</head>

	<body>
	<form method="post" enctype="multipart/form-data" id = "form">
		<input type="file" name="file" size="50" id = "hidden" style="display:none;margin:auto;width:60%;padding:10px"/>
		<input type="submit" class = "action-button" id = "confirm" style="display:none;margin:auto;width:60%;padding:10px"/>
		</form>
		<form method = "Post">
			<div>
    			<p class = "submit-row form-row button">
					<input type = "button" value = "Upload" class = "action-button" id = "button"></input>
				</p>
			</div>
			<div>

    			<p class = "submit-row form-row button">
					<input type = "button" value = "Download" class = "action-button" id = "download"></input>
				</p>
			</div>
			<div>
				<p class = "submit-row form-row button">
					<input type = "submit" value = "Share" class = "action-button" formaction ="share.html"></input>
				</p>
			</div>
			<div>
				<p class = "submit-row form-row button">
					<input type = "button" value = "Delete" class = "action-button" id = "delete"></input>
				</p>
			</div>
			<div>
				<p class = "submit-row form-row button">
					<input type = "submit" value = "Settings" class = "action-button" formaction ="Settings.html"></input>
				</p>
			</div>
			<div>
				<p class = "submit-row form-row button">
					<input type = "submit" value = "Logout" class = "action-button" formaction ="logout.html"></input>
				</p>
			</div>
			<fieldset>
				<legend>The Vault</legend>
					<table width="100%" id = "table">
						<thead>
							<tr>
								<th>File</th>
								<th>Size</th>
							</tr>
						</thead>
						
						<tbody>
						</tbody>
					</table> 
			</fieldset>
		</form>
	</body>
<script>
	$(document).ready(function() {
		var username = getCookie("fileServiceUsername");
		document.cookie = "fileServiceUsername=;expires=Thu, 01 Jan 1970 00:00:01 GMT;";
		$("#form").attr("action", "http://fileservice:4000/fileService/uploadFile/" + username);
		$.get("http://fileservice:4000/fileService/getList/" + username, function( data ) {
			console.log(data);
			console.log(data.length);
			for (var i = data.length - 1; i >= 0; i--)
			{
				$('#table').append('<tr><td>' + data[i][0] + '</td><td>' + data[i][1] + ' KB</td></tr>');
			}
		});
		$("#download").click(function() {
			document.cookie="fileServiceUsername=" + username + ";path=/";
			window.open("download.html", "_self")
		});
		$("#delete").click(function() {
			document.cookie="fileServiceUsername=" + username + ";path=/";
			window.open("delete.html", "_self")
		});
	});

	function getCookie(name) {
		var value = "; " + document.cookie;
		var parts = value.split("; " + name + "=");
		if (parts.length == 2) return parts.pop().split(";").shift();
	}

	$('#button').click(function() {
		console.log("test");
		$('#hidden').click();
	});
	$("#hidden").change(function(){
		//submit the form here
		$('#confirm').css('display', 'block');
		var filename = $('#hidden').val().split('\\').pop();
		$('#confirm').val("Upload " + filename)
		$('#form').css('display', 'block');

	});
</script>
</html>