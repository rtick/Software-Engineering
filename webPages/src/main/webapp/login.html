<!-- 
	Name: Ryan Tick, James Harkins, Kyle Kozak
	Date: 09/14/2015
	Class: Software Engineering
	HW: Horizontal Design
	Login Page
-->

<!DOCTYPE html>

<html>

	<head>
		<title> Login </title>
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
        <script src="./rollups/aes.js"></script>
        <script src="./rollups/sha1.js"></script>
        <script src="./components/core-min.js"></script>
        <script src="./components/enc-base64-min.js"></script>
        <script src="./components/enc-utf16.js"></script>
	</head>
	<body>
    <nav role="navigation" class="navbar navbar-default">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" data-target="#navbarCollapse" data-toggle="collapse" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="login.html" class="navbar-brand">FileUpload</a>
        </div>
        <!-- Collection of nav links and other content for toggling -->
        <div id="navbarCollapse" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="login.html">Login</a></li>
                <li><a href="register.html">Register</a></li>
            </ul>
        </div>
    </nav>
    <div class="container">
        <div class="login">
            <h4>FileUpload Login</h4>
            <hr>
            <form class="login-inner">
                <input class="form-control email" id="username" placeholder="Enter Username">
                <input type="password" class="form-control password" id="password" placeholder="Password">
                <label class="checkbox-inline">
                    <input type="checkbox" id="remember" value="Remember me" style="color:white"> Remember me
                </label>
                <input class="btn btn-block btn-lg btn-default submit"  value="Login" id = "login">
            </form>
            <a href="register.html" class="btn btn-sm btn-default register">Register</a>
            <a href="#" class="btn btn-sm btn-default forgot">Forgot Password</a>
        </div>
    </div>
	</body>
    <style>
        body {
            background-image: url("clouds.jpg");
        }
        .login {
            margin-top: 25px !important;
            padding: 5px;
            width: auto;
            min-width: 320px;
            max-width: 400px;
            height: 300px;
            background-color: #00ffe8;
            margin:0 auto;
            border-radius: 10px;
            border: 1px solid black;
            text-align: center;
        }
        hr {
            border-top: 1px solid black;
        }
        .login-inner {
            margin:0 auto;
            max-width: 380px;
            width: auto;
        }
        .login>h4 {
            font-size: 20px;
            margin-left: 5px;
            font-weight: 600;
            color: black;
        }
        .email {
            margin-bottom: 5px;
        }
        .password {
            margin-bottom: 5px;
        }
        .submit {
            margin-top: 5px;
        }
        .submit:hover
        {
            background-color:#0033cc;
            border-color:black;
            color: white;
        }
        .forgot {
            min-width:50px;
            width: 49%;
            float: right;
            margin-top: 20px;
        }
        .forgot:hover
        {
            background-color:#0033cc;
            border-color:black;
            color: white;
        }
        .register {
            width: 50%;
            float: left;
            margin-top: 20px;
        }
        a {
            color: black;
        }
        .register:hover
        {
            background-color:#0033cc;
            border-color:black;
            color: white;
        }
        @media (max-width: 320px) {
            .forgot {
                font-size: 9px;
                font-weight: 700;
                padding: 8px;
            }
        }
        .navbar-default {
            background-color: #00ffff;
            border-color: #0033cc;
        }
        .navbar-default .navbar-brand {
            color: #000000;
        }
        .navbar-default .navbar-brand:hover, .navbar-default .navbar-brand:focus {
            color: #fbfbfb;
            background-color:#0033cc;
        }
        .navbar-default .navbar-text {
            color: #000000;
        }
        .navbar-default .navbar-nav > li > a {
            color: #000000;
        }
        .navbar-default .navbar-nav > li > a:hover, .navbar-default .navbar-nav > li > a:focus {
            color: #fbfbfb;
            background-color:#0033cc;
        }
        .navbar-default .navbar-nav > .active > a, .navbar-default .navbar-nav > .active > a:hover, .navbar-default .navbar-nav > .active > a:focus {
            color: #fbfbfb;
            background-color: #0033cc;
        }
        .navbar-default .navbar-nav > .open > a, .navbar-default .navbar-nav > .open > a:hover, .navbar-default .navbar-nav > .open > a:focus {
            color: #fbfbfb;
            background-color: #0033cc;
        }
        .navbar-default .navbar-toggle {
            border-color: #0033cc;
        }
        .navbar-default .navbar-toggle:hover, .navbar-default .navbar-toggle:focus {
            background-color: #0033cc;
        }
        .navbar-default .navbar-toggle .icon-bar {
            background-color: #000000;
        }
        .navbar-default .navbar-collapse,
        .navbar-default .navbar-form {
            border-color: #000000;
        }
        .navbar-default .navbar-link {
            color: #000000;
        }
        .navbar-default .navbar-link:hover {
            color: #fbfbfb;
        }

        @media (max-width: 767px) {
            .navbar-default .navbar-nav .open .dropdown-menu > li > a {
                color: #000000;
            }
            .navbar-default .navbar-nav .open .dropdown-menu > li > a:hover, .navbar-default .navbar-nav .open .dropdown-menu > li > a:focus {
                color: #fbfbfb;
            }
            .navbar-default .navbar-nav .open .dropdown-menu > .active > a, .navbar-default .navbar-nav .open .dropdown-menu > .active > a:hover, .navbar-default .navbar-nav .open .dropdown-menu > .active > a:focus {
                color: #fbfbfb;
                background-color: #0033cc;
            }
        }
    </style>
<script>
	$("#login").click(function() {
        var ip = document.location.host;
        ip = ip.split(":")[0];
        var password = CryptoJS.AES.encrypt($("#password").val(), $("#password").val()).toString();
        password = replaceAll("/","*",password);
        $.get("http://" + ip + ":4000/fileService/login/" + $("#username").val() + "/" + password, function( data ) {
			if (data == "Unconfirmed")
			{
				window.alert("Please verify your email")
			}
            else if (data == "Unsuccessful")
            {
                window.alert("Username or password incorrect");
            }
			else
			{
                data = replaceAll("_","/",data);
                var password = CryptoJS.AES.decrypt(data, $("#password").val()).toString(CryptoJS.enc.Latin1);
                if (password == $("#password").val())
                {
                    document.cookie="fileServiceUsername=" + $("#username").val() + ";path=/";
                    document.cookie="fileServicePassword=" + $("#password").val() + ";path=/";
                    window.open("main.html", "_self")
                }
                else {
                    window.alert("Username or password incorrect");
                }
			}
		});
	});
    function replaceAll(find, replace, str) {
        return str.replace(new RegExp(find, 'g'), replace);
    }
</script>
</html>